<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BonusCoin Minter</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5;
      display: flex;
      justify-content: center;
      padding: 30px;
    }
    #bonuscoinMinter {
      max-width: 450px;
      width: 100%;
      padding: 25px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      text-align: center;
    }
    h2 { color: #2c3e50; margin-bottom: 20px; }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 12px;
      transition: 0.3s;
    }
    #connectWallet { background: #4caf50; color: #fff; }
    #connectWallet:hover { background: #45a049; }
    #mintButton { background: #2196f3; color: #fff; }
    #mintButton:hover { background: #1976d2; }
    #status { margin-top: 10px; padding: 10px; background: #e8f4fd; border-radius: 10px; min-height: 24px; color: #2c3e50; }
    #mintAddress { margin-top: 10px; padding: 10px; background: #e0ffe0; border-radius: 10px; min-height: 24px; color: #2c3e50; word-break: break-all; }
  </style>
</head>
<body>
  <div id="bonuscoinMinter">
    <h2>BonusCoin Token Minter</h2>
    <button id="connectWallet">Connect Wallet</button>
    <input type="text" id="tokenName" placeholder="Token Name" value="BonusCoin">
    <input type="text" id="tokenSymbol" placeholder="Token Symbol" value="BONUS">
    <textarea id="tokenDescription" placeholder="Description">Official BonusCoin token</textarea>
    <button id="mintButton">Mint BonusCoin</button>
    <div id="status"></div>
    <div id="mintAddress"></div>
  </div>

  <!-- Solana Web3.js -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.77.0/lib/index.iife.min.js"></script>
  <!-- SPL Token -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.3.8/lib/index.iife.min.js"></script>
  <!-- Wallet Adapter -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-base@0.9.32/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-wallets@0.9.32/lib/index.iife.min.js"></script>

  <script>
    window.addEventListener('load', async () => {
      const statusEl = document.getElementById('status');
      const mintAddressEl = document.getElementById('mintAddress');

      const { Connection, clusterApiUrl, PublicKey, Transaction } = solanaWeb3;
      const { createMint, getOrCreateAssociatedTokenAccount, mintTo, TOKEN_PROGRAM_ID } = splToken;

      const connection = new Connection(clusterApiUrl('devnet'), 'confirmed'); // use devnet for testing
      let wallet = null;

      // Connect wallet (Phantom)
      document.getElementById('connectWallet').onclick = async () => {
        try {
          if (window.solana && window.solana.isPhantom) {
            wallet = window.solana;
            const resp = await wallet.connect();
            statusEl.innerText = "Wallet connected: " + resp.publicKey.toString();
          } else {
            alert("Install Phantom wallet!");
          }
        } catch (err) {
          statusEl.innerText = "Connection failed: " + err.message;
        }
      };

      // Mint Token
      document.getElementById('mintButton').onclick = async () => {
        if (!wallet || !wallet.publicKey) { 
          alert("Connect wallet first!"); 
          return; 
        }

        const name = document.getElementById('tokenName').value;
        const symbol = document.getElementById('tokenSymbol').value;
        const decimals = 9;
        const totalSupply = 1000000n; // smaller supply for devnet
        const totalUnits = totalSupply * 10n ** BigInt(decimals);

        statusEl.innerText = "Creating mint...";

        try {
          // Phantom does not give a Keypair, so we manually build a transaction
          const mintKeypair = solanaWeb3.Keypair.generate();

          // Create mint transaction
          const mintTx = new solanaWeb3.Transaction().add(
            splToken.createInitializeMintInstruction(
              mintKeypair.publicKey,
              decimals,
              wallet.publicKey,
              null,
              TOKEN_PROGRAM_ID
            )
          );

          // Create associated token account for wallet
          const ata = await getOrCreateAssociatedTokenAccount(
            connection,
            wallet, // Phantom signs
            mintKeypair.publicKey,
            wallet.publicKey
          );

          // Mint tokens
          const mintTx2 = new solanaWeb3.Transaction().add(
            splToken.createMintToInstruction(
              mintKeypair.publicKey,
              ata.address,
              wallet.publicKey,
              Number(totalUnits)
            )
          );

          // Phantom signs the transactions
          mintTx.feePayer = wallet.publicKey;
          mintTx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
          const signedTx = await wallet.signTransaction(mintTx);
          await connection.sendRawTransaction(signedTx.serialize(), { skipPreflight: false, preflightCommitment: 'confirmed' });

          mintTx2.feePayer = wallet.publicKey;
          mintTx2.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
          const signedTx2 = await wallet.signTransaction(mintTx2);
          await connection.sendRawTransaction(signedTx2.serialize(), { skipPreflight: false, preflightCommitment: 'confirmed' });

          statusEl.innerText = "BonusCoin minted successfully!";
          mintAddressEl.innerText = "Mint Address: " + mintKeypair.publicKey.toBase58();

        } catch (err) {
          console.error(err);
          statusEl.innerText = "Error: " + (err.message || err.toString());
        }
      };
    });
  </script>
</body>
</html>
