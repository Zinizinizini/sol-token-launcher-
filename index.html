<script>
async function connectWalletFunc() {
  logsEl.innerText = '';
  wallet = getSelectedWallet();
  if (!wallet) {
    logStep('‚ùå Please select a wallet first.');
    return;
  }

  try {
    logStep(`Selected wallet: ${wallet.name}`);
    logStep('Step 1: Connecting wallet...');
    const resp = await wallet.wallet.connect();
    publicKey = resp?.publicKey || wallet.wallet.publicKey;
    logStep('Connected: ' + publicKey.toString());

    logStep('Step 2: Creating Solana connection via Helius...');
    const connection = new web3.Connection(
      'https://mainnet.helius-rpc.com/?api-key=b933e448-6fee-4016-b4ec-3c6c19a46775',
      'confirmed'
    );

    logStep('Step 3: Fetching SOL balance...');
    const lamports = await connection.getBalance(publicKey);
    logStep('üí∞ SOL Balance: ' + (lamports / 1e9).toFixed(6) + ' SOL');

    logStep('Step 4: Fetching SPL tokens...');
    const tokenAccounts = await connection.getParsedTokenAccountsByOwner(
      publicKey,
      { programId: new web3.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA") }
    );

    if (tokenAccounts.value.length === 0) logStep('No SPL tokens found.');
    else tokenAccounts.value.forEach((t, i) => {
      const info = t.account.data.parsed.info;
      logStep(`${i + 1}. Mint: ${info.mint}, Amount: ${info.tokenAmount.uiAmountString}`);
    });

    logStep('‚úÖ Wallet connection complete.');
  } catch (err) {
    logStep('‚ùå Error: ' + err.message);
    console.error(err);
  }
}
</script>
